# Results

---
title: "Results"
author: "Charlie Sturr"
date: "12/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE,
                      echo = TRUE)

bookdown::render_book(new_session = TRUE)

library(ggplot2)
library(dplyr)
library(ggnewscale)
library(patchwork)
library(ExcelFunctionsR)
library(tidyverse)
library(rmarkdown)

```




## Aggregating gross and total gross  

```{r, echo=FALSE}


movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")
t_gross <- as.numeric(movies$Total.Gross)/100000
gross <- as.numeric(movies$Gross)/100000
gross_df_aggregate <- data.frame(gross, t_gross, movies$Year)
total_by_year1<- aggregate(gross~movies.Year, data=gross_df_aggregate, sum) 
total_by_year2<- aggregate(t_gross~movies.Year, data=gross_df_aggregate, sum) 
year_merged <- merge(total_by_year1, total_by_year2, "movies.Year")
g <- ggplot(year_merged, aes(x = movies.Year))
g <- g + geom_line(aes(y = gross), color = "red")
g <- g + geom_line(aes(y = t_gross), color = "blue")
g

```

 
## COVID IMPACT GOES HERE 

If we zoom our cut in - we can see the month by month drop off. 


```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

t_gross <- as.numeric(movies$Total.Gross)/100000
gross <- as.numeric(movies$Gross)/100000

gross_df_aggregate <- data.frame(gross, t_gross, movies$Year, movies$month)

total_by_year1<- aggregate(gross~movies.Year+movies.month, data=gross_df_aggregate, sum) 
total_by_year1 <- total_by_year1 %>% filter(total_by_year1$movies.Year >2017)
total_by_year1$date <- with(total_by_year1, sprintf("%s-%02s", movies.Year, movies.month))

total_by_year2<- aggregate(t_gross~movies.Year+movies.month, data=gross_df_aggregate, sum) 
total_by_year2 <- total_by_year2 %>% filter(total_by_year2$movies.Year >2017)
total_by_year2$date <- with(total_by_year2, sprintf("%s-%02s", movies.Year, movies.month))

year_merged <- merge(total_by_year1, total_by_year2, "date")
tidy_merged <- data.frame(year_merged$date, year_merged$gross, year_merged$t_gross) %>% pivot_longer(!year_merged.date, names_to = "type", values_to = "gross")

g <- ggplot(year_merged, aes(x = year_merged$date, group = 1))
g <- g + geom_line(aes(y = year_merged$gross), color = "red")
g <- g + geom_line(aes(y = year_merged$t_gross), color = "blue")
g


```



## Studios across the board have struggled too 

Filtering only studios who have made over 1B and less than 1B

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000


studio_df <- data.frame(gross, movies$Studio, movies$Year)

total_by_studio<- aggregate(gross~movies.Studio, data=studio_df, sum) %>%
  arrange(desc(gross))

aggregate_df<- aggregate(gross~movies.Studio+movies.Year, data=studio_df, sum) %>%
  arrange(desc(gross)) 

final_merged <- merge(aggregate_df, total_by_studio, "movies.Studio") %>% filter(gross.y>10000)


g_over_1b <- ggplot(data=final_merged, aes(x=movies.Year, y=gross.x, color = movies.Studio))+ 
  geom_line()

final_merged <- merge(aggregate_df, total_by_studio, "movies.Studio") %>% filter(gross.y<10000, gross.y>5000)


g_over_500M <- ggplot(data=final_merged, aes(x=movies.Year, y=gross.x, color = movies.Studio))+ 
  geom_line()


final_merged <- merge(aggregate_df, total_by_studio, "movies.Studio") %>% filter(gross.y<5000, gross.y>1000)


g_less_500M <- ggplot(data=final_merged, aes(x=movies.Year, y=gross.x, color = movies.Studio))+ 
  geom_line()



g_over_1b 
g_over_500M 
g_less_500M

for_table <- data.frame(gross, movies$Studio, movies$Year, movies$Title) %>% filter(movies$Studio %in% c("Walt Disney Studios Motion Pictures", "Warner Bros.", "Universal Pictures", "Twentieth Century Fox", "The Weinstein Company", "Sony Pictures Entertainment (SPE)", "Paramount Pictures", "Lionsgate"))
  
  
```


## Ratings over time 


```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")


month <- as.numeric(movies$month)
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- as.numeric(movies$Year)

averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)

years = c(2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021)


total_ratings_aggregate <- as.data.frame(years)


averages_df = data.frame(matrix(nrow = 1, ncol = length(years))) 
  
# assign column names
colnames(averages_df) = years


year_range <- 2011:2021

k = 1

for(i in year_range){
    averages_chart <- averages_chart %>% filter(!is.na(averages_chart$critic_score), averages_chart$year == i)
    averages_df[1,k] = mean(averages_chart$critic_score)
    averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
    k = k+1
  }
    

averages_df[nrow(averages_df) + 1,] = years


averages_transposed = as.data.frame(t(averages_df))


names(averages_transposed)[2] <- "years"
names(averages_transposed)[1] <- "avg"
total_ratings_aggregate$critic <- averages_transposed$avg



month <- as.numeric(movies$month)
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- as.numeric(movies$Year)

averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)

years = c(2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021)


averages_df = data.frame(matrix(nrow = 1, ncol = length(years))) 
  
# assign column names
colnames(averages_df) = years


year_range <- 2011:2021

k = 1

for(i in year_range){
    averages_chart <- averages_chart %>% filter(!is.na(averages_chart$audience_score), averages_chart$year == i)
    averages_df[1,k] = mean(averages_chart$audience_score)
    averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
    k = k+1
  }
    

averages_df[nrow(averages_df) + 1,] = years


averages_transposed = as.data.frame(t(averages_df))


names(averages_transposed)[2] <- "years"
names(averages_transposed)[1] <- "avg"
total_ratings_aggregate$audience <- averages_transposed$avg



month <- as.numeric(movies$month)
rating <- as.numeric(movies$average_rating)*10
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- as.numeric(movies$Year)

averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)

years = c(2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021)

averages_df = data.frame(matrix(nrow = 1, ncol = length(years))) 
  
# assign column names
colnames(averages_df) = years


year_range <- 2011:2021

k = 1

for(i in year_range){
    averages_chart <- averages_chart %>% filter(!is.na(averages_chart$rating), averages_chart$year == i)
    averages_df[1,k] = mean(averages_chart$rating)
    averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
    k = k+1
  }
    

averages_df[nrow(averages_df) + 1,] = years


averages_transposed = as.data.frame(t(averages_df))


names(averages_transposed)[2] <- "years"
names(averages_transposed)[1] <- "avg"
total_ratings_aggregate$imdb <- averages_transposed$avg




g <- ggplot(total_ratings_aggregate, aes(x = years))
g <- g + geom_line(aes(y = audience), color = "red")
g <- g + geom_line(aes(y = critic), color = "blue")
g <- g + geom_line(aes(y = imdb), color = "purple")
g

```





## Correlation between audience and critic scores - aggregate 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0), aes(x = audience_score, y = critic_score)) + geom_point()
g2<- ggplot(correlation_df %>% filter(gross > 1000), aes(x = audience_score, y = critic_score)) + geom_point()
g3<- ggplot(correlation_df %>% filter(gross > 2000), aes(x = audience_score, y = critic_score)) + geom_point()
g4<- ggplot(correlation_df %>% filter(gross > 5000), aes(x = audience_score, y = critic_score)) + geom_point()

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


#test 

```


## Correlation between audience and IMDB score - aggregate 

```{r, echo=FALSE}

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0), aes(x = audience_score, y = rating)) + geom_point()
g2<- ggplot(correlation_df %>% filter(gross > 1000), aes(x = audience_score, y = rating)) + geom_point()
g3<- ggplot(correlation_df %>% filter(gross > 2000), aes(x = audience_score, y = rating)) + geom_point()
g4<- ggplot(correlation_df %>% filter(gross > 5000), aes(x = audience_score, y = rating)) + geom_point()

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


```



## Correlation between critic and IMDB score - aggregate 

```{r, echo=FALSE}

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0), aes(x = critic_score, y = rating)) + geom_point()
g2<- ggplot(correlation_df %>% filter(gross > 1000), aes(x = critic_score, y = rating)) + geom_point()
g3<- ggplot(correlation_df %>% filter(gross > 2000), aes(x = critic_score, y = rating)) + geom_point()
g4<- ggplot(correlation_df %>% filter(gross > 5000), aes(x = critic_score, y = rating)) + geom_point()

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


```




## Correlation between total gross and audience score - aggregate 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0), aes(x = audience_score, y = gross)) + geom_point() +geom_smooth(method = lm)
g2<- ggplot(correlation_df %>% filter(gross > 1000), aes(x = audience_score, y = gross)) + geom_point()+geom_smooth(method = lm)
g3<- ggplot(correlation_df %>% filter(gross > 2000), aes(x = audience_score, y = gross)) + geom_point()+geom_smooth(method = lm)
g4<- ggplot(correlation_df %>% filter(gross > 5000), aes(x = audience_score, y = gross)) + geom_point()+geom_smooth(method = lm)

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


#test 

```



## Correlation between total gross and critic score - aggregate 

```{r, echo=TRUE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0), aes(x = critic_score, y = gross)) + geom_point() +geom_smooth(method = lm)
g2<- ggplot(correlation_df %>% filter(gross > 1000), aes(x = critic_score, y = gross)) + geom_point()+geom_smooth(method = lm)
g3<- ggplot(correlation_df %>% filter(gross > 2000), aes(x = critic_score, y = gross)) + geom_point()+geom_smooth(method = lm)
g4<- ggplot(correlation_df %>% filter(gross > 5000), aes(x = critic_score, y = gross)) + geom_point()+geom_smooth(method = lm)

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


#test 

```




## Correlation by year - audience vs. critic 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")


gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- movies$Year

total_year <- data.frame(movies$Title, gross, rating, audience_score, critic_score, year)

year_chart <- ggplot(total_year %>% filter(gross > 500), aes(x = audience_score, y = critic_score)) + geom_point()+ 
  geom_smooth(method=lm) +facet_wrap(~year)

year_chart


```




## Correlation by year - imdb vs. audience 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")


gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- movies$Year

total_year <- data.frame(movies$Title, gross, rating, audience_score, critic_score, year)

year_chart <- ggplot(total_year %>% filter(gross > 500), aes(x = rating, y = audience_score)) + geom_point()+ 
  geom_smooth(method=lm) +facet_wrap(~year)

year_chart


```




## Correlation by year - imdb vs. critic 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")


gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- movies$Year

total_year <- data.frame(movies$Title, gross, rating, audience_score, critic_score, year)

year_chart <- ggplot(total_year %>% filter(gross > 500), aes(x = rating, y = critic_score)) + geom_point()+ 
  geom_smooth(method=lm) +facet_wrap(~year)

year_chart


```





## Correlation between total gross and IMDB score - aggregate 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0), aes(x = rating, y = gross)) + geom_point() +geom_smooth(method = lm)
g2<- ggplot(correlation_df %>% filter(gross > 1000), aes(x = rating, y = gross)) + geom_point()+geom_smooth(method = lm)
g3<- ggplot(correlation_df %>% filter(gross > 2000), aes(x = rating, y = gross)) + geom_point()+geom_smooth(method = lm)
g4<- ggplot(correlation_df %>% filter(gross > 5000), aes(x = rating, y = gross)) + geom_point()+geom_smooth(method = lm)

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


#test 

```



## Correlation between total gross and critic score - aggregate 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0, critic_score>50), aes(x = critic_score, y = gross)) + geom_point() +geom_smooth(method = lm)
g2<- ggplot(correlation_df %>% filter(gross > 1000, critic_score>50), aes(x = critic_score, y = gross)) + geom_point()+geom_smooth(method = lm)
g3<- ggplot(correlation_df %>% filter(gross > 2000,critic_score>50), aes(x = critic_score, y = gross)) + geom_point()+geom_smooth(method = lm)
g4<- ggplot(correlation_df %>% filter(gross > 5000,critic_score>50), aes(x = critic_score, y = gross)) + geom_point()+geom_smooth(method = lm)

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


#test 

```





## Correlation between total gross and IMDB score - aggregate 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0, rating>5), aes(x = rating, y = gross)) + geom_point() +geom_smooth(method = lm)
g2<- ggplot(correlation_df %>% filter(gross > 1000, rating>5), aes(x = rating, y = gross)) + geom_point()+geom_smooth(method = lm)
g3<- ggplot(correlation_df %>% filter(gross > 2000, rating>5), aes(x = rating, y = gross)) + geom_point()+geom_smooth(method = lm)
g4<- ggplot(correlation_df %>% filter(gross > 5000, rating>5), aes(x = rating, y = gross)) + geom_point()+geom_smooth(method = lm)

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


#test 

```







##Box and Whisker - IMDB rating and gross 


```{r, echo=FALSE}


correlation_df$band <- 1
  
  
  
correlation_df <- correlation_df %>%
                  mutate(band = ifelse(rating <1, "0-0.9", 
                                ifelse(rating<2, "1-1.9",
                                      ifelse(rating<3,"2-2.9",
                                             ifelse(rating<4,"3-3.9",
                                                    ifelse(rating<5,"4-4.9",
                                                           ifelse(rating<6,"5-5.9",
                                                                  ifelse(rating<7,"6-6.9",
                                                                         ifelse(rating<8,"7-7.9",
                                                                                ifelse(rating<9,"8-8.9",
                                                                                       ifelse(rating<=10,"9-10")))))))))))



g_imdb <- ggplot(data = correlation_df %>% filter(gross > 1000), mapping = aes(x = gross, y = band)) + 
  geom_boxplot(outlier.color = 'red') + xlab("gross") + ylab("ratings band") + ggtitle("Box Plot of gross by IMDB ratings band")+   theme(plot.title = element_text(hjust = 0.5))

g_imdb

```



##Box and Whisker - audience rating and gross 


```{r, echo=FALSE}


correlation_df$audience_band <- 1
  
correlation_df <- correlation_df %>%
                  mutate(audience_band = ifelse(audience_score <10, "0-0.9", 
                                ifelse(audience_score<20, "1-1.9",
                                      ifelse(audience_score<30,"2-2.9",
                                             ifelse(audience_score<40,"3-3.9",
                                                    ifelse(audience_score<50,"4-4.9",
                                                           ifelse(audience_score<60,"5-5.9",
                                                                  ifelse(audience_score<70,"6-6.9",
                                                                         ifelse(audience_score<80,"7-7.9",
                                                                                ifelse(audience_score<90,"8-8.9",
                                                                                       ifelse(audience_score<=100,"9-10","na")))))))))))



g_audience <- ggplot(data = correlation_df %>% filter(gross > 1000), mapping = aes(x = gross, y = audience_band)) + 
  geom_boxplot(outlier.color = 'red') + xlab("gross") + ylab("ratings band") + ggtitle("Box Plot of gross by Audience ratings band")+   theme(plot.title = element_text(hjust = 0.5))

g_audience

```


##Box and Whisker - critic rating and gross 


```{r, echo=FALSE}


correlation_df$critic_band <- 1
  
correlation_df <- correlation_df %>%
                  mutate(critic_band = ifelse(critic_score <10, "0-0.9", 
                                ifelse(critic_score<20, "1-1.9",
                                      ifelse(critic_score<30,"2-2.9",
                                             ifelse(critic_score<40,"3-3.9",
                                                    ifelse(critic_score<50,"4-4.9",
                                                           ifelse(critic_score<60,"5-5.9",
                                                                  ifelse(critic_score<70,"6-6.9",
                                                                         ifelse(critic_score<80,"7-7.9",
                                                                                ifelse(critic_score<90,"8-8.9",
                                                                                       ifelse(critic_score<=100,"9-10","na")))))))))))



g_critic <- ggplot(data = correlation_df %>% filter(gross > 1000), mapping = aes(x = gross, y = critic_band)) + 
  geom_boxplot(outlier.color = 'red') + xlab("gross") + ylab("ratings band") + ggtitle("Box Plot of gross by Critic ratings band")+   theme(plot.title = element_text(hjust = 0.5))

g_critic

```




```{r, echo=FALSE}

g_imdb + g_audience + g_critic + plot_layout(widths = 3, heights = 3)

```



## Aggregating and filtering top earning studios 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000


studio_df <- data.frame(gross, movies$Studio)

aggregate_df<- aggregate(gross~movies.Studio, data=studio_df, sum) %>%
  arrange(desc(gross))




```



## Average IMDB rating by month and year

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")


month <- as.numeric(movies$month)
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- as.numeric(movies$Year)

averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)


months <- data.frame(c(1,2,3,4,5,6,7,8,9,10,11,12))
years = c(2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021)

averages_df = data.frame(matrix(nrow = 12, ncol = length(years))) 
  
# assign column names
colnames(averages_df) = years

averages_df$month = c(1,2,3,4,5,6,7,8,9,10,11,12)


averages_chart <- averages_chart %>% filter(averages_chart$month == 5, averages_chart$year == 2012)

my_range <- 1:12
year_range <- 2011:2021

k = 0

for(i in year_range){
  averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
  k = k+1
  for(j in my_range){
    
    averages_chart <- averages_chart %>% filter(!is.na(averages_chart$rating), averages_chart$month == j, averages_chart$year == i)
    averages_df[j,k] = mean(averages_chart$rating)
    averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
  }
    
}


averages_df$month = c(1,2,3,4,5,6,7,8,9,10,11,12)

tidy_averages <- averages_df %>% pivot_longer(!month, names_to = "year", values_to = "averages")

tidy_averages$Date <- with(tidy_averages, sprintf("%s-%02s", year, month))


imdb_time<- ggplot(tidy_averages, aes(Date, averages, fill=year)) + geom_col()+ 
  theme(axis.text.x = element_text(angle = 65, hjust = 1)) 

```

## Average audience rating by month and year

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")


month <- as.numeric(movies$month)
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- as.numeric(movies$Year)

averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)


months <- data.frame(c(1,2,3,4,5,6,7,8,9,10,11,12))
years = c(2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021)


averages_df = data.frame(matrix(nrow = 12, ncol = length(years))) 
  
# assign column names
colnames(averages_df) = years

averages_df$month = c(1,2,3,4,5,6,7,8,9,10,11,12)


averages_chart <- averages_chart %>% filter(averages_chart$month == 5, averages_chart$year == 2012)

my_range <- 1:12
year_range <- 2011:2021

k = 0

for(i in year_range){
  averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
  k = k+1
  for(j in my_range){
    
    averages_chart <- averages_chart %>% filter(!is.na(averages_chart$audience_score), averages_chart$month == j, averages_chart$year == i)
    averages_df[j,k] = mean(averages_chart$audience_score)
    averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
  }
    
}


averages_df$month = c(1,2,3,4,5,6,7,8,9,10,11,12)

tidy_averages <- averages_df %>% pivot_longer(!month, names_to = "year", values_to = "averages")

tidy_averages$Date <- with(tidy_averages, sprintf("%s-%02s", year, month))


audience_time<- ggplot(tidy_averages, aes(Date, averages, fill=year)) + geom_col()+ 
  theme(axis.text.x = element_text(angle = 65, hjust = 1)) 

```


## Average critic rating by month and year

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")


month <- as.numeric(movies$month)
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)
year <- as.numeric(movies$Year)

averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)


months <- data.frame(c(1,2,3,4,5,6,7,8,9,10,11,12))
years = c(2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021)

averages_df = data.frame(matrix(nrow = 12, ncol = length(years))) 
  
# assign column names
colnames(averages_df) = years

averages_df$month = c(1,2,3,4,5,6,7,8,9,10,11,12)


averages_chart <- averages_chart %>% filter(averages_chart$month == 5, averages_chart$year == 2012)

my_range <- 1:12
year_range <- 2011:2021

k = 0

for(i in year_range){
  averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
  k = k+1
  for(j in my_range){
    
    averages_chart <- averages_chart %>% filter(!is.na(averages_chart$critic_score), averages_chart$month == j, averages_chart$year == i)
    averages_df[j,k] = mean(averages_chart$critic_score)
    averages_chart <- data.frame(movies$Title, month, rating, audience_score, critic_score, year)
  }
    
}


averages_df$month = c(1,2,3,4,5,6,7,8,9,10,11,12)

tidy_averages <- averages_df %>% pivot_longer(!month, names_to = "year", values_to = "averages")

tidy_averages$Date <- with(tidy_averages, sprintf("%s-%02s", year, month))


critic_time <- ggplot(tidy_averages, aes(Date, averages, fill=year)) + geom_col()+ 
  theme(axis.text.x = element_text(angle = 65, hjust = 1)) 

```


## Average critic rating by month and year

```{r, echo=FALSE}

imdb_time
audience_time
critic_time

```


###GRAVEYARD

#Filtering by "Good and bad movies"


## Correlation between total gross and audience score - aggregate 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

correlation_df <- data.frame(gross, rating, audience_score, critic_score)

g1<- ggplot(correlation_df %>% filter(gross > 0, audience_score>50), aes(x = audience_score, y = gross)) + geom_point() +geom_smooth(method = lm)
g2<- ggplot(correlation_df %>% filter(gross > 1000, audience_score>50), aes(x = audience_score, y = gross)) + geom_point()+geom_smooth(method = lm)
g3<- ggplot(correlation_df %>% filter(gross > 2000, audience_score>50), aes(x = audience_score, y = gross)) + geom_point()+geom_smooth(method = lm)
g4<- ggplot(correlation_df %>% filter(gross > 5000, audience_score>50), aes(x = audience_score, y = gross)) + geom_point()+geom_smooth(method = lm)

g1 + g2 + g3 + g4 +plot_layout(widths = c(1, 1), heights = c(1,1))


#test 

```





## Aggregating and filtering top earning studios 

```{r, echo=FALSE}

movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

gross <- as.numeric(movies$Total.Gross)/100000


studio_df <- data.frame(gross, movies$Studio, movies$Year)

total_by_studio<- aggregate(gross~movies.Studio, data=studio_df, sum) %>%
  arrange(desc(gross))

aggregate_df<- aggregate(gross~movies.Studio+movies.Year, data=studio_df, sum) %>%
  arrange(desc(gross)) 

final_merged <- merge(aggregate_df, total_by_studio, "movies.Studio") %>% filter(gross.y>20000)


ggplot(data=final_merged, aes(x=movies.Year, y=gross.x, color = movies.Studio))+ 
  geom_line()


for_table <- data.frame(gross, movies$Studio, movies$Year, movies$Title) %>% filter(movies$Studio %in% c("Walt Disney Studios Motion Pictures", "Warner Bros.", "Universal Pictures", "Twentieth Century Fox", "The Weinstein Company", "Sony Pictures Entertainment (SPE)", "Paramount Pictures", "Lionsgate"))
  
  
```



## CORRELATION by genre

```{r, echo=FALSE}


movies <- read.csv("/Users/Charlie Sturr/OneDrive/Desktop/Columbia/01. Fall_2021/Data Viz/MOVIES_Final_12.11.2021_vAC.csv")

head(movies)

gross <- as.numeric(movies$Total.Gross)/100000
rating <- as.numeric(movies$average_rating)
audience_score <- as.numeric(movies$Score_Audience)
critic_score <- as.numeric(movies$Score_Rotten)

genre_df <- data.frame(movies$Title, gross, audience_score, critic_score, rating, movies$genre1, movies$genre2, movies$genre3, movies$genre)
colnames(genre_df) = c("title", "gross", "score_audience", "score_rotten", "average_rating", "genre1", "genre2", "genre3", "genre")

aggregate_genre1<- aggregate(gross~genre1, data=genre_df, sum) %>%
  arrange(desc(gross))

aggregate_genre2<- aggregate(gross~genre2, data=genre_df %>% filter(genre_df$genre2 != ""), sum) %>%
  arrange(desc(gross))

aggregate_genre3<- aggregate(gross~genre3, data=genre_df %>% filter(genre_df$genre3 != ""), sum) %>%
  arrange(desc(gross))

aggregate_genre <- aggregate(gross~genre, data=genre_df %>% filter(genre_df$genre != ""), sum) %>% 
  arrange(desc(gross))


genre1_unique <- unique(genre_df$genre1)
genre2_unique <- unique(genre_df$genre2)
genre3_unique <- unique(genre_df$genre3)

genre_unique <- unique(genre_df$genre)


g_genre1 <- ggplot(data = genre_df %>% filter(gross > 1000), mapping = aes(x = gross, y = genre1)) + 
  geom_boxplot(outlier.color = 'red') + xlab("gross") + ylab("ratings band") + ggtitle("Box Plot of gross by IMDB ratings band")+   theme(plot.title = element_text(hjust = 0.5))


g_genre2 <- ggplot(data = genre_df %>% filter(gross > 1000), mapping = aes(x = gross, y = genre2)) + 
  geom_boxplot(outlier.color = 'red') + xlab("gross") + ylab("ratings band") + ggtitle("Box Plot of gross by IMDB ratings band")+   theme(plot.title = element_text(hjust = 0.5))


g_genre3 <- ggplot(data = genre_df %>% filter(gross > 1000), mapping = aes(x = gross, y = genre3)) + 
  geom_boxplot(outlier.color = 'red') + xlab("gross") + ylab("ratings band") + ggtitle("Box Plot of gross by IMDB ratings band")+   theme(plot.title = element_text(hjust = 0.5))




g_genre1
g_genre2
g_genre3


genre_filtered <- genre_df %>% filter(gross>50, genre1 == c("Action", "Adventure", "Comedy", "Biography", "Horror", "Documentary", "Animation"), score_audience != "MISSING VALUE")


genre_correlation <- ggplot(genre_filtered, aes(x = score_audience, y = gross)) + geom_point()+ 
  geom_smooth(method=lm) + facet_wrap(~genre1)

genre_correlation





```



















